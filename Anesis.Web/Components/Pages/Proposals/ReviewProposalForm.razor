@inject IApiService _apiService
@inject NotificationService _notifyService
@inject DialogService _dialogService

<RadzenTemplateForm TItem="ProposalReviewModel" Data="ReviewModel" Submit="ReviewProposalAsync">
    <RadzenStack>
        <RadzenFieldset Text="Proposal Information">
            <RadzenStack Gap="1rem">
                <RadzenRow>
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenLabel Text="Proposed Procedure" Component="ProcedureId" class="rz-text-subtitle2" />
                    </RadzenColumn>
                    <RadzenColumn Size="12" SizeMD="8">
                        <RadzenDropDown @bind-Value="ReviewModel.ProcedureId" Name="ProcedureId" Data="ActiveProcedures"
                                        AllowClear="true" AllowFiltering="true" ClearSearchAfterSelection="true"
                                        TextProperty="Value" ValueProperty="Key"
                                        Placeholder="---Select---" Style="width: 100%;" />
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow>
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenLabel Text="Diagnosis Code" Component="DiagnosisCode" class="rz-text-subtitle2" />
                    </RadzenColumn>
                    <RadzenColumn Size="12" SizeMD="8">
                        <RadzenNumeric @bind-Value="ReviewModel.DiagnosisCode" Name="DiagnosisCode" Style="width: 100%;" />
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow>
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenLabel Text="Reviewer Notes" Component="ReviewerNotes" class="rz-text-subtitle2" />
                    </RadzenColumn>
                    <RadzenColumn Size="12" SizeMD="8">
                        <RadzenTextArea @bind-Value="ReviewModel.ReviewerNotes" Name="ReviewerNotes" Rows="3" Style="width: 100%" />
                    </RadzenColumn>
                </RadzenRow>
            </RadzenStack>
        </RadzenFieldset>
        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="1rem">
            <RadzenButton ButtonType="ButtonType.Submit" ButtonStyle="ButtonStyle.Primary"
                          Text="Approve" Icon="check_circle" />
            <RadzenButton ButtonType="ButtonType.Button" ButtonStyle="ButtonStyle.Danger"
                          Text="Cancel" Icon="cancel" />
            <RadzenButton ButtonType="ButtonType.Button" ButtonStyle="ButtonStyle.Base"
                          Text="Close" Click="() => _dialogService.Close()" />
        </RadzenStack>
    </RadzenStack>
</RadzenTemplateForm>

@code {
    [Parameter]
    public ProposalReviewModel ReviewModel { get; set; }
    [Parameter]
    public Dictionary<int, string> ActiveProcedures { get; set; }

    [Parameter]
    public EventCallback OnRefreshGrid { get; set; }

    // SUPPORT METHODS
    public async Task ReviewProposalAsync(ProposalReviewModel reviewModel)
    {

    }

    private async Task RefreshGridAsync()
    {
        await OnRefreshGrid.InvokeAsync();
    }
}
